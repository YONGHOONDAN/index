<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>위치 마커 & 메모 — PWA v5 (드래그 + API검색)</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
<style>
:root { --header-h: 56px; --panel-h: 40vh; }
html,body { height: 100%; margin: 0; padding: 0; }
body { font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Arial, sans-serif; }
header { position: fixed; top: 0; left: 0; right: 0; background: #1e90ff; color: #fff; display:flex; flex-wrap:wrap; align-items:center; gap:6px; padding:6px; z-index:1000; }
header strong { font-size:16px; white-space:nowrap; margin-right:6px; }
header button { padding:8px 10px; font-size:14px; border-radius:8px; border:0; }
#map { position:absolute; top: var(--header-h); left:0; right:0; bottom: 0; transition: bottom .2s ease; }
#resultsPanel.open ~ #map { bottom: var(--panel-h); }
#resultsPanel { position: fixed; left:0; right:0; bottom:0; height: var(--panel-h); background:#fff; border-top-left-radius:14px; border-top-right-radius:14px; box-shadow: 0 -8px 24px rgba(0,0,0,.25); z-index:1100; transform: translateY(calc(100% - 44px)); transition: transform .25s ease; touch-action: none; }
#resultsPanel.open { transform: translateY(0); }
.drag-handle { width:100%; height:20px; cursor:grab; display:flex; justify-content:center; align-items:center; }
.drag-bar { width:40px; height:4px; background:#ccc; border-radius:2px; }
.rp-head { display:flex; align-items:center; justify-content:space-between; padding:4px 12px; border-bottom:1px solid #eee; }
.rp-title { display:flex; align-items:center; gap:8px; }
.pill { display:inline-block; padding:4px 8px; border:1px solid #ddd; border-radius:999px; font-size:12px; background:#fafafa; cursor:pointer; }
.rp-body { height: calc(var(--panel-h) - 48px); overflow:auto; padding:10px 12px; }
.list { display:grid; grid-template-columns: 1fr; gap:8px; }
.item { border:1px solid #eee; border-radius:10px; padding:10px; }
.item b { display:block; margin-bottom:4px; }
.meta { font-size:12px; color:#666; }
.actions { margin-top:6px; display:flex; gap:6px; flex-wrap:wrap; }
@media (max-width: 420px){ :root{ --panel-h: 50vh; } }
</style>
</head>
<body>
<header>
<strong>위치 마커 & 메모</strong>
<button id="locBtn">현재 위치</button>
<button id="addCenterBtn">중심 마커</button>
<button id="togglePanelBtn">맛집 리스트</button>
</header>
<div id="map"></div>
<section id="resultsPanel">
<div class="drag-handle"><div class="drag-bar"></div></div>
<div class="rp-head">
<div class="rp-title"><strong>주변 맛집</strong><span id="where" class="pill"></span></div>
<div><button id="refreshBtn" class="pill">새로고침</button></div>
</div>
<div class="rp-body"><div id="list" class="list"></div></div>
</section>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
let map, markersLayer;
function getCurrentPositionOnce(){ return new Promise((res,rej)=>{ navigator.geolocation.getCurrentPosition(res,rej,{enableHighAccuracy:true}); }); }
function gmapsSearch(lat,lng){ return fetch(`https://nominatim.openstreetmap.org/search?format=json&q=restaurant&bounded=1&limit=10&viewbox=${lng-0.02},${lat+0.02},${lng+0.02},${lat-0.02}`);
}
async function renderList(){ const p=await getCurrentPositionOnce().catch(()=>({coords:{latitude:37.5665,longitude:126.9780}})); const lat=p.coords.latitude,lng=p.coords.longitude; document.getElementById('where').textContent=`${lat.toFixed(5)},${lng.toFixed(5)}`;
const res=await gmapsSearch(lat,lng); const data=await res.json(); const list=document.getElementById('list');
list.innerHTML=data.map(d=>`<div class='item'><b>${d.display_name.split(',')[0]}</b><div class='meta'>${(d.lat*1).toFixed(5)}, ${(d.lon*1).toFixed(5)}</div><div class='actions'><a class='pill' target='_blank' href='https://www.google.com/maps/search/?api=1&query=${d.lat},${d.lon}'>지도 열기</a></div></div>`).join('');
}
window.addEventListener('load',()=>{
map=L.map('map').setView([37.5665,126.9780],13);
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
markersLayer=L.layerGroup().addTo(map);
document.getElementById('locBtn').onclick=async()=>{ const p=await getCurrentPositionOnce(); map.setView([p.coords.latitude,p.coords.longitude],16); };
document.getElementById('addCenterBtn').onclick=()=>{ const c=map.getCenter(); L.marker([c.lat,c.lng]).addTo(markersLayer); };
document.getElementById('togglePanelBtn').onclick=()=>{ document.getElementById('resultsPanel').classList.toggle('open'); renderList(); };
document.getElementById('refreshBtn').onclick=renderList;
// 드래그 기능
const panel=document.getElementById('resultsPanel'); let startY,startH;
panel.querySelector('.drag-handle').addEventListener('touchstart',e=>{ startY=e.touches[0].clientY; startH=panel.getBoundingClientRect().height; },{passive:true});
panel.querySelector('.drag-handle').addEventListener('touchmove',e=>{ const dy=startY-e.touches[0].clientY; let newH=startH+dy; if(newH<100)newH=100; if(newH>window.innerHeight)newH=window.innerHeight; panel.style.height=newH+'px'; });
});
</script>
</body>
</html>
