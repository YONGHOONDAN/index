<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>위치 마커 & 메모 — PWA v3 (iPhone XS 최적화)</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="마커 & 메모" />
  <meta name="theme-color" content="#1e90ff" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
  <style>
    :root { --header-h: auto; }
    html,body { height: 100%; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Arial, sans-serif; }
    header {
      position: fixed;
      top: 0; left: 0; right: 0;
      background: #1e90ff;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      padding: 6px;
      gap: 6px;
      z-index: 1000;
    }
    header strong {
      font-size: 16px;
      text-align: center;
    }
    .control {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 6px;
      background: white;
      padding: 6px;
      border-radius: 4px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.2);
      font-size: 14px;
      color: #000;
    }
    header button, header input[type="file"] {
      width: 100%;
      padding: 8px;
      font-size: 14px;
    }
    #map {
      position: absolute;
      top: calc( var(--header-h) + 100px);
      top: calc(env(safe-area-inset-top) + 110px);
      bottom: 0; left: 0; right: 0;
    }
    #markerList {
      position: absolute;
      right: 8px; top: calc(env(safe-area-inset-top) + 180px);
      width: 280px; max-height: 50vh; overflow: auto;
      background: rgba(255,255,255,0.95);
      padding: 8px;
      border-radius: 6px;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .m-item { padding: 6px; border-bottom: 1px solid #eee; }
    .m-item small { color: #666; display: block; margin-top: 4px; }
    .btn-sm { padding: 4px 6px; font-size: 12px; margin-left: 6px; }
    textarea { width: 100%; height: 80px; font-family: inherit; }
    #warn { position: fixed; bottom: 8px; left: 8px; right: 8px; background: #fff3cd; color: #664d03; border: 1px solid #ffec99; border-radius: 6px; padding: 8px; display: none; z-index: 1001; }
    #warn b { display: inline-block; margin-right: 6px; }
  </style>
</head>
<body>
  <header>
    <strong>위치 마커 & 메모</strong>
    <div class="control">
      <button id="locBtn" title="현재 위치로 이동">현재 위치로 이동</button>
      <button id="markHereBtn" title="현재 위치에 마커 추가">현재 위치에 마커</button>
      <button id="addCenterBtn" title="지도 중심에 마커 추가">현재 중심에 마커</button>
      <button id="exportBtn" title="마커 내보내기(JSON)">내보내기</button>
      <input id="importFile" type="file" accept="application/json" title="JSON 파일로 가져오기">
      <button id="clearBtn" title="모든 마커 삭제">모두 삭제</button>
    </div>
  </header>

  <div id="map" aria-label="지도"></div>
  <div id="markerList" style="display:none"></div>
  <div id="warn"></div>

  <!-- 기존 스크립트는 그대로 유지 -->
  <!-- ... 나머지 자바스크립트 부분 동일 ... -->

<!-- 모바일 최적화 추가 스크립트 -->
<script>
  (function(){
    const headerEl = document.querySelector('header');
    const root = document.documentElement;
    function syncHeaderHeight(){ root.style.setProperty('--header-h', headerEl.offsetHeight + 'px'); }
    if (headerEl && 'ResizeObserver' in window) {
      syncHeaderHeight(); new ResizeObserver(syncHeaderHeight).observe(headerEl);
      window.addEventListener('orientationchange', ()=> setTimeout(syncHeaderHeight, 300));
    }

    function onReady(fn){ if (document.readyState !== 'loading') fn(); else document.addEventListener('DOMContentLoaded', fn); }
    onReady(function(){
      const importBtn = document.getElementById('importBtn');
      const importFile = document.getElementById('importFile');
      if (importBtn && importFile) importBtn.onclick = () => importFile.click();

      const toggleListBtn = document.getElementById('toggleListBtn');
      const markerList = document.getElementById('markerList');
      if (toggleListBtn && markerList) toggleListBtn.onclick = () => {
        markerList.style.display = (markerList.style.display==='none' || !markerList.style.display) ? 'block' : 'none';
      };

      const fabLoc = document.getElementById('fab-loc');
      const fabAdd = document.getElementById('fab-add');
      const locBtn = document.getElementById('locBtn');
      const addCenterBtn = document.getElementById('addCenterBtn');
      if (fabLoc && locBtn) fabLoc.onclick = () => locBtn.click();
      if (fabAdd && addCenterBtn) fabAdd.onclick = () => addCenterBtn.click();
    });
  })();
</script>
</body>
</html>
